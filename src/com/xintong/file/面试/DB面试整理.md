# 数据库面试

##### 数据库ACID

##### 事务的隔离级别

- 读未提交

- 读已提交

- 可重复读

- 串行化

##### 脏读 幻读 可重复读

- 脏读
- 幻读
- 可重读读

##### 1 *什么情况下索引失效

- or可能会引失效：or的左右任意一个字段只要没有创建索引，那么这条语句就会失效

- like可能会引失效：like左边如果也加上%，会导致索引失效
- 复合索引未用左列字段
- 需要类型转换 varchar却用了int  没带引号会造成隐式类型转换
- where中索引列有运算
- where中索引列使用了函数
- 如果mysql觉得全表扫描更快时（数据少）

##### char和varchar的区别

- char定长，所以在效率上高一点
- varchar长度不固定，所以效率差一点，但是不会存在资源浪费

##### 2 *数据库性能优化

##### 3 *Sql优化

##### 4 *分表主键怎么设计

##### 5 *批量导入MySql1000万条数据，实现思路/大量数据插入数据库速度慢如何优化 

如果说是大批量数据单条提交的话必然会慢，可以考虑将数据合并成批量插入，使用StringBuffer去拼接，比如说我10/20/30W次分一个事务提交一次，这样下来肯定会比单条要快好多

##### 6 *数据库乐观锁悲观锁有用过吗，实现？

乐观锁：一般利用表字段的version+1来实现（如SVN、GIT提交代码就是这样的）

悲观锁：一般是 where id=XX for update 来实现 （一般银行转账、工单审批

##### 7 *创建索引的依据

应该创建的情况

- where 后边频繁出现的字段，就可以考虑创建索引
- 经常做连接的表，在连接字段上创建索引

不应该创建的情况      

- 字段中数据重复性高，去极端情况数据全都一样，加了和没加一样，跟全表扫描没有区别
- 频繁更新的字段不要使用索引，频繁改变会导致索引页频繁变化导致数据库压力变大

 面试官如果深入问你，你就可以和他说索引的优缺点注意事项什么的



​       面试官如果深入问你，你就可以和他说索引的优缺点注意事项什么的

##### 8 *行锁跟表锁区别 

- 表级锁：开销小，加锁快，不会出现死锁。锁定粒度大，发生锁冲突的概率最高，并发量最低
- 行级锁：开销大，加锁慢，会出现死锁。锁力粒度小，发生锁冲突的概率小，并发度最高

##### 9 *Mysql索引类型

##### 10 * 为什么用B+树，不用其他类型

**先说二叉树系列**

不管你平衡二叉树、二叉搜索树还是红黑树，只要你属于二叉树，每个节点必然最多只有两个子节点，那么在数据量一大，树的高度是比较大的，而磁盘进行差查找的次数往往取决于树的高度，而磁盘存取原理是这样的**磁盘存取原理**，所以呢，因为树的高度，所以二叉树系列肯定是不合适的

**再说B树**

- B树呢他的所有叶子节点的高度都是完全一样的

- 而且每个节点可以有多个子节点，这个就避免了二叉树哪种树太高而导致多次IO的情况

- 另外它的每个节点上都存有数据，有可能根节点直接找到，有可能在某个叶节点找到，所以这也就导致了如果使用B树做索引，查询的不稳定性，

  最致命的原因是，B树做精准查询确实是没问题的，但是要做范围查询的话，因为他每个数据之间并没有联系，比如你查一个>8的所有数字，比如我有1000个，那我还得做好几千次IO，这肯定是不能接受的

**再说Hash**

实际上Mysql也是支持Hash做索引，不过局限性比较大，精确查询确实是没有问题，但是不能用它做范围查询

**最后再说B+树**

B+树在B树的基础上做了些改变，首先他的非叶子节点不存数据只存key，所有的数据只存在于树顶的叶子节点，而且更重要的是，数据之间存有前后的指针，可以看做是一个链表，我只要拿到了你，我就能很简单的拿到你的下一个，基于这个原因解决了范围查找的问题，所以说B+树相比去其他类型，更合适

##### 11 Myisam和innodb区别

最主要是事务问题，InnoDB支持事务，MyISAM不支持事务。另外还有其他的原因，比如说InnoDB支持外键、而MyISAM不支持外键；InnoDB必须要有主键而MyISAM可以不用主键；InnoDB的表在硬盘中会生成两个文件一个表结构，一个是数据+索引，而MyISAM生成表结构、索引、数据三个文件

##### 12 覆盖索引

只查询创建了索引的相关列的字段，这种情况下效率会很好，因为他直接从索引中拿值不走数据表

##### 磁盘读取原理

![image-20200512111236751](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200512111236751.png)

![image-20200512111251721](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200512111251721.png)

- 寻道时间(速度慢，费时)
- 旋转时间(速度较快)

磁盘读取分为两步骤。首先寻道，磁头由内向外或者由外向内移动寻找相应的磁道，接着旋转，磁盘旋转到对应的扇区然后再读取数据，而寻道的这个过程是比较耗时的，这个可以从硬件层面去解释为什么很多时候IO会是系统的瓶颈

